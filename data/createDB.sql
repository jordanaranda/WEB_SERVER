PRAGMA encoding = "UTF-8";
PRAGMA foreign_keys = ON;

-- CREATE TABLES --

CREATE TABLE PERMISSIONS (
	"id" INTEGER NOT NULL PRIMARY KEY,
	"permission" TEXT NOT NULL
);

CREATE TABLE USERS (
	"id" INTEGER NOT NULL PRIMARY KEY,
	"name" TEXT NOT NULL,
	"email" TEXT NOT NULL,
	"password" TEXT NOT NULL,
	"security_question" INTEGER NOT NULL,
	"security_answer" TEXT NOT NULL,
	"send_emails_updates" INTEGER NOT NULL,
	"first_date" INTEGER,
	"last_date" INTEGER,
	"connected" INTEGER,
	"blocked" INTEGER
);

CREATE TABLE USERS_PERMISSIONS (
	"id_user" INTEGER NOT NULL REFERENCES USERS (id) ON DELETE CASCADE,
	"id_permission" INTEGER NOT NULL REFERENCES PERMISSIONS (id) ON DELETE CASCADE,
	PRIMARY KEY (id_user, id_permission)
);

CREATE TABLE TYPE_QUESTIONS (
    "id" INTEGER NOT NULL,
    "type_question" TEXT NOT NULL,
    "id_permission" INTEGER NOT NULL REFERENCES PERMISSIONS(id) ON DELETE CASCADE
);

CREATE TABLE QUESTIONS (
	"id" INTEGER NOT NULL PRIMARY KEY,
	"question" TEXT NOT NULL,
	"image_path" TEXT NOT NULL,
	"id_type_question" INTEGER NOT NULL REFERENCES TYPE_QUESTION(id) ON DELETE CASCADE
);

CREATE TABLE ANSWERS (
	"id" INTEGER NOT NULL PRIMARY KEY,
	"answer" TEXT NOT NULL,
	"is_correct" INTEGER NOT NULL,
	"id_question" INTEGER NOT NULL REFERENCES QUESTIONS(id) ON DELETE CASCADE
);

CREATE TABLE USERS_QUESTIONS (
	"id_user" INTEGER NOT NULL REFERENCES USERS(id) ON DELETE CASCADE,
	"id_type_question" INTEGER NOT NULL REFERENCES TYPE_QUESTIONS(id) ON DELETE CASCADE,
	"successes" INTEGER NOT NULL,
	"failures" INTEGER NOT NULL,
	PRIMARY KEY(id_user, id_type_question)
);